let canvas,ctx,huge=!1,size=2049;(window.innerHeight>(size-1)/2||window.innerHeight>(size-1)/2)&&(size=4097);const roughness=1;let startMiddle=.5,middle=startMiddle,margin=6e-4,angle=0;const amplitude=.2,frequency=.003;let minPixelRatio=1e-4;console.log("Generating fractal...");const t1=performance.now();let fractal_array=diamondSquare(size,1);const t2=performance.now();function diamondSquare(e,t){let n=Array(e).fill().map(()=>Array(e).fill(0));n[0][0]=Math.random(),n[0][e-1]=Math.random(),n[e-1][0]=Math.random(),n[e-1][e-1]=Math.random();let a=e-1;for(;a>1;){let i=a>>1;for(let l=0;l<e-1;l+=a)for(let r=0;r<e-1;r+=a){let d=(n[l][r]+n[l+a][r]+n[l][r+a]+n[l+a][r+a])/4;n[l+i][r+i]=d+(Math.random()-.5)*t}for(let $=0;$<e;$+=i)for(let o=($+i)%a;o<e;o+=a){let s=0,c=0;$>=i&&(s+=n[$-i][o],c++),$+i<e&&(s+=n[$+i][o],c++),o>=i&&(s+=n[$][o-i],c++),o+i<e&&(s+=n[$][o+i],c++);let g=s/c;n[$][o]=g+(Math.random()-.5)*t}a=i,t*=.5}return n}function resizeCanvas(e,t,n,a){a.fillStyle="#323232";let i=n.width,l=n.height,r=e-margin,d=e+margin,$=Math.min(size,i),o=Math.min(size,l),s=0;a.clearRect(0,0,i,l),a.beginPath();for(let c=0;c<$;c++){let g=t[c];for(let h=0;h<o;h++){let m=g[h];m>r&&m<d&&(a.rect(c,h,1,1),s++)}}s/(i*l)<minPixelRatio&&(e=startMiddle=Math.random(.2,.8)),huge=s/(i*l)>.05,a.fill(),a.closePath()}function updateMiddle(){let e=40;for(huge&&(e*=2),middle=startMiddle+.2*Math.cos(angle),angle+=.003,resizeCanvas(middle,fractal_array,canvas,ctx);canvas.width!==window.innerWidth&&canvas.height!==window.innerHeight;)canvas.width=window.innerWidth,canvas.height=window.innerHeight;setTimeout(updateMiddle,e)}console.log("Fractal generated in "+(t2-t1)+" ms"),window.onload=function(){ctx=(canvas=document.getElementById("backgroundCanvas")).getContext("2d"),updateMiddle(),window.addEventListener("resize",()=>{canvas.width=window.innerWidth,canvas.height=window.innerHeight})};
